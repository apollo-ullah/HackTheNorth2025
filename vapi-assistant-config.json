{
  "name": "Stacy AI Safety Companion",
  "model": {
    "provider": "openai",
    "model": "gpt-4o-mini",
    "messages": [
      {
        "role": "system",
        "content": "You are Stacy, a professional AI emergency dispatcher with natural conversation skills and intelligent response capabilities.\n\nCORE PRINCIPLES:\n\nüéØ CONVERSATION INTELLIGENCE:\n- Have natural, flowing conversations - never repeat the same question\n- Build on what the user tells you - reference their previous statements\n- Ask NEW questions based on their responses, don't loop\n- Vary your language: 'What's happening?' then 'Tell me more' then 'I see, what else?'\n\n‚ö° EMERGENCY RESPONSE:\n- Auto-assess risk: SAFE ‚Üí ELEVATED ‚Üí CRITICAL\n- Take action while talking (update case files, send alerts)\n- No permission needed in emergencies - just act\n- Use context clues: tone, time, keywords, background sounds\n\nüó£Ô∏è CONVERSATION FLOW:\nSAFE: Natural chat, build rapport, gather info casually\nELEVATED: More focused questions, start taking precautionary actions\nCRITICAL: Action mode - 'I'm calling police now, stay with me, where exactly are you?'\n\nüß† SMART RESPONSES:\n- Never ask the same question twice in a conversation\n- Build on user responses: 'You mentioned X, can you tell me about Y?'\n- Use varied phrasing: 'What's going on?' / 'Tell me more' / 'I understand, what happened next?'\n- Remember what they've already told you\n\n‚ö†Ô∏è EMERGENCY DETECTION:\n- 'help', 'emergency', 'following me' ‚Üí CRITICAL instantly\n- Nervous tone + concerning context ‚Üí ELEVATED\n- 'I'm scared' + alone + night ‚Üí Auto-escalate\n\nüö® EMERGENCY TRANSFER PROTOCOL:\nFor CRITICAL situations requiring immediate police response:\n1. Use transfer_to_emergency_services function with destination '+15146605707'\n2. Provide clear reason for transfer (e.g., 'Active threat reported', 'User in immediate danger')\n3. Tell user: 'I'm connecting you with emergency services now. I'll brief them about your situation first.'\n4. VAPI will handle the warm transfer - you brief the dispatcher, then connect the user\n5. Trust VAPI's built-in transfer system - don't try to manage the call yourself\n\nYour goal: Have natural emergency dispatcher conversations that flow logically without repetition. Use the transfer function for CRITICAL emergencies only."
      }
    ],
    "tools": [
      {
        "type": "function",
        "function": {
          "name": "update_casefile",
          "description": "Update the emergency case file with new information",
          "parameters": {
            "type": "object",
            "properties": {
              "caseId": {
                "type": "string",
                "description": "Unique case identifier"
              },
              "riskLevel": {
                "type": "string",
                "enum": ["SAFE", "ELEVATED", "CRITICAL"],
                "description": "Current risk assessment level"
              },
              "threat": {
                "type": "object",
                "properties": {
                  "description": { "type": "string" },
                  "type": { "type": "string" },
                  "immediacy": {
                    "type": "string",
                    "enum": ["immediate", "developing", "potential"]
                  }
                }
              },
              "userStatus": {
                "type": "object",
                "properties": {
                  "canSpeak": { "type": "boolean" },
                  "canText": { "type": "boolean" },
                  "isHidden": { "type": "boolean" }
                }
              },
              "location": {
                "type": "object",
                "properties": {
                  "lat": { "type": "number" },
                  "lng": { "type": "number" },
                  "accuracy": { "type": "number" }
                }
              }
            },
            "required": ["caseId"]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "notify_emergency_contact",
          "description": "Send comprehensive emergency report to emergency contact",
          "parameters": {
            "type": "object",
            "properties": {
              "contactName": { "type": "string" },
              "contactPhone": { "type": "string" },
              "urgentMessage": { "type": "string" },
              "includeLocation": { "type": "boolean", "default": true }
            },
            "required": ["contactName", "contactPhone", "urgentMessage"]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "send_location_sms",
          "description": "Send SMS with current location to any phone number",
          "parameters": {
            "type": "object",
            "properties": {
              "phoneNumber": { "type": "string" },
              "message": { "type": "string" },
              "urgent": { "type": "boolean", "default": false }
            },
            "required": ["phoneNumber", "message"]
          }
        }
      },
      {
        "type": "transferCall",
        "destinations": [
          {
            "type": "number",
            "number": "+15146605707",
            "description": "Emergency services - police dispatcher",
            "transferPlan": {
              "mode": "warm-transfer-with-summary",
              "summaryPlan": {
                "enabled": true,
                "messages": [
                  {
                    "role": "system",
                    "content": "You are Stacy AI Emergency Dispatcher providing a professional emergency briefing to police. Provide a concise summary including: risk level, location, threat description, and user status."
                  },
                  {
                    "role": "user",
                    "content": "Emergency briefing for Case ID {{caseId}}:\n\nCall Transcript:\n{{transcript}}\n\nProvide a professional emergency dispatch summary."
                  }
                ]
              }
            }
          }
        ],
        "messages": [
          {
            "type": "request-start",
            "content": "I'm connecting you with emergency services now. I'll brief them about your situation first, then you can speak directly with them. Stay on the line."
          }
        ],
        "function": {
          "name": "transfer_to_emergency_services",
          "description": "Transfer the call to emergency services when the situation is CRITICAL. Use this when immediate police response is needed.",
          "parameters": {
            "type": "object",
            "properties": {
              "destination": {
                "type": "string",
                "enum": ["+15146605707"],
                "description": "Emergency services number to transfer to"
              },
              "reason": {
                "type": "string",
                "description": "Brief reason for the emergency transfer"
              }
            },
            "required": ["destination", "reason"]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "analyze_context",
          "description": "SMART: Analyze conversation context for hidden urgency signals and auto-escalate",
          "parameters": {
            "type": "object",
            "properties": {
              "userMessage": { "type": "string", "description": "User's last message" },
              "toneAnalysis": { "type": "string", "enum": ["calm", "nervous", "panicked", "whispering", "crying"], "description": "Detected emotional tone" },
              "contextClues": { "type": "array", "items": { "type": "string" }, "description": "List of concerning details noticed" },
              "inferredThreat": { "type": "string", "description": "What you think is really happening" },
              "confidenceLevel": { "type": "number", "minimum": 0, "maximum": 100, "description": "How confident you are in threat assessment" }
            },
            "required": ["userMessage", "toneAnalysis", "inferredThreat", "confidenceLevel"]
          }
        }
      },
      {
        "type": "function",
        "function": {
          "name": "get_safe_locations",
          "description": "Find nearby safe locations like police stations, hospitals",
          "parameters": {
            "type": "object",
            "properties": {
              "radius": { "type": "number", "default": 5000 }
            }
          }
        }
      }
    ]
  },
  "voice": {
    "provider": "openai",
    "model": "tts-1-hd",
    "voice": "nova",
    "speed": 1.0,
    "chunkPlan": {
      "enabled": true,
      "minCharacters": 30
    }
  },
  "transcriber": {
    "provider": "deepgram",
    "model": "nova-2",
    "language": "en",
    "smartFormat": true,
    "endpointing": 300
  },
  "firstMessage": "This is Stacy. I can sense you may need help - I'm analyzing your situation now. Tell me what's happening.",
  "firstMessageMode": "assistant-speaks-first",
  "endCallMessage": "Stay safe. You can call me again anytime you need help.",
  "endCallPhrases": ["goodbye stacy", "end call", "hang up"],
  "serverMessages": [
    "conversation-update",
    "function-call",
    "hang",
    "speech-update"
  ],
  "clientMessages": [
    "conversation-update",
    "function-call",
    "hang",
    "speech-update"
  ],
  "server": {
    "url": "https://your-domain.vercel.app/api/vapi/webhook",
    "timeoutSeconds": 20
  },
  "backgroundSound": "office",
  "maxDurationSeconds": 1800,
  "voicemailDetection": {
    "provider": "twilio",
    "enabled": true
  }
}
