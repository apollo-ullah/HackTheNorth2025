"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/stacy/chat";
exports.ids = ["pages/api/stacy/chat"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "openai":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstacy%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fstacy%2Fchat.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstacy%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fstacy%2Fchat.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/stacy/chat.ts */ \"(api)/./pages/api/stacy/chat.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/stacy/chat\",\n        pathname: \"/api/stacy/chat\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_stacy_chat_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnN0YWN5JTJGY2hhdCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGc3RhY3klMkZjaGF0LnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3NEO0FBQ3REO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxxREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMscURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdmFwaS12b2ljZS1hZ2VudC1uZXh0anMvP2YzZTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9zdGFjeS9jaGF0LnRzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3RhY3kvY2hhdFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3N0YWN5L2NoYXRcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstacy%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fstacy%2Fchat.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/stacy/chat.ts":
/*!*********************************!*\
  !*** ./pages/api/stacy/chat.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { OPENAI_API_KEY } = process.env;\n    if (!OPENAI_API_KEY) {\n        return res.status(500).json({\n            error: \"OpenAI API key not configured\"\n        });\n    }\n    try {\n        const { message, messages, location, sessionId, riskLevel, mode } = req.body;\n        if (!message) {\n            return res.status(400).json({\n                error: \"Message is required\"\n            });\n        }\n        const openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n            apiKey: OPENAI_API_KEY\n        });\n        // Build conversation context\n        const conversationHistory = (messages || []).slice(-10).map((m)=>({\n                role: m.role,\n                content: m.content\n            }));\n        // Build system prompt with current context\n        const systemPrompt = `You are Stacy, a professional AI safety companion and emergency dispatcher. Keep responses concise and helpful.\n\nCURRENT CONTEXT:\n- Session: ${sessionId}\n- Risk Level: ${riskLevel}\n- Location: ${location ? `${location.lat.toFixed(4)}, ${location.lng.toFixed(4)}` : \"Unknown\"}\n- Mode: ${mode}\n\nGUIDELINES:\n- For emergencies: Be direct, gather key details, prepare to escalate\n- For general safety: Provide supportive guidance and check-ins  \n- Always validate concerns and provide actionable advice\n- Keep responses under 2 sentences for voice mode\n- Ask ONE focused question at a time\n\nRespond professionally and warmly. Help users feel safe and supported.`;\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-4\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                },\n                ...conversationHistory,\n                {\n                    role: \"user\",\n                    content: message\n                }\n            ],\n            temperature: 0.7,\n            max_tokens: 500\n        });\n        const aiResponse = completion.choices[0]?.message?.content;\n        if (!aiResponse) {\n            throw new Error(\"No response from OpenAI\");\n        }\n        // Analyze the response to determine risk level and actions\n        const riskAnalysis = analyzeRiskLevel(message, aiResponse, riskLevel);\n        const actions = determineActions(aiResponse, riskAnalysis.riskLevel, location);\n        console.log(`ðŸ¤– Stacy AI Response for session ${sessionId} (${mode} mode):`);\n        console.log(`ðŸ“Š Risk: ${riskLevel} â†’ ${riskAnalysis.riskLevel}`);\n        console.log(`ðŸŽ¯ Actions: ${actions.join(\", \") || \"None\"}`);\n        console.log(`ðŸ’¬ Response: ${aiResponse.substring(0, 100)}...`);\n        // Never TTS here - client controls TTS based on mode\n        return res.status(200).json({\n            reply: aiResponse,\n            mode: mode,\n            riskLevel: riskAnalysis.riskLevel,\n            riskChanged: riskAnalysis.riskLevel !== riskLevel,\n            confidence: riskAnalysis.confidence,\n            actions,\n            reasoning: riskAnalysis.reasoning,\n            timestamp: new Date().toISOString(),\n            caseFile: riskAnalysis.riskLevel !== \"SAFE\" ? {\n                id: `case_${sessionId}_${Date.now()}`,\n                sessionId,\n                riskLevel: riskAnalysis.riskLevel,\n                location,\n                timeline: [\n                    {\n                        timestamp: new Date().toISOString(),\n                        event: `User reported: ${message}`,\n                        riskLevel: riskAnalysis.riskLevel,\n                        aiResponse: aiResponse\n                    }\n                ]\n            } : null\n        });\n    } catch (error) {\n        console.error(\"âŒ Stacy AI error:\", error);\n        // Fallback response for critical situations\n        const isCritical = req.body.message?.toLowerCase().match(/(help|emergency|danger|police|attacked|following)/);\n        return res.status(500).json({\n            error: \"AI processing error\",\n            fallback: true,\n            reply: isCritical ? \"I'm having technical difficulties, but I understand this may be urgent. Please call 911 immediately if you're in immediate danger. I'm working to restore full service.\" : \"I'm experiencing technical difficulties. Please try again, or use the emergency button if this is urgent.\",\n            riskLevel: isCritical ? \"CRITICAL\" : \"ELEVATED\",\n            actions: isCritical ? [\n                \"emergency_handoff\"\n            ] : []\n        });\n    }\n}\nfunction analyzeRiskLevel(userMessage, aiResponse, currentRisk) {\n    const message = userMessage.toLowerCase();\n    const response = aiResponse.toLowerCase();\n    // Critical indicators\n    const criticalKeywords = [\n        \"help\",\n        \"emergency\",\n        \"danger\",\n        \"attacked\",\n        \"following me\",\n        \"scared\",\n        \"unsafe\",\n        \"call police\",\n        \"threat\",\n        \"weapon\",\n        \"violence\",\n        \"hurt\",\n        \"stalking\",\n        \"chase\",\n        \"trapped\"\n    ];\n    // Elevated indicators  \n    const elevatedKeywords = [\n        \"suspicious\",\n        \"uncomfortable\",\n        \"worried\",\n        \"alone\",\n        \"dark\",\n        \"lost\",\n        \"nervous\",\n        \"strange\",\n        \"creepy\",\n        \"uneasy\",\n        \"concerned\",\n        \"anxious\"\n    ];\n    const criticalCount = criticalKeywords.filter((keyword)=>message.includes(keyword) || response.includes(keyword)).length;\n    const elevatedCount = elevatedKeywords.filter((keyword)=>message.includes(keyword) || response.includes(keyword)).length;\n    // AI response analysis - look for dispatcher language\n    const dispatcherLanguage = [\n        \"emergency services\",\n        \"law enforcement\",\n        \"immediate\",\n        \"critical\",\n        \"urgent\",\n        \"dispatch\",\n        \"officer\",\n        \"patrol\",\n        \"backup\"\n    ].some((term)=>response.includes(term));\n    let riskLevel = \"SAFE\";\n    let confidence = 0.5;\n    let reasoning = \"Standard safety check\";\n    if (criticalCount >= 2 || dispatcherLanguage) {\n        riskLevel = \"CRITICAL\";\n        confidence = 0.9;\n        reasoning = `Critical keywords detected (${criticalCount}) or emergency response language identified`;\n    } else if (criticalCount >= 1) {\n        riskLevel = \"CRITICAL\";\n        confidence = 0.8;\n        const detectedKeyword = criticalKeywords.find((k)=>message.includes(k) || response.includes(k));\n        reasoning = `Critical safety keyword detected: ${detectedKeyword}`;\n    } else if (elevatedCount >= 2) {\n        riskLevel = \"ELEVATED\";\n        confidence = 0.7;\n        reasoning = `Multiple concern indicators (${elevatedCount})`;\n    } else if (elevatedCount >= 1) {\n        riskLevel = \"ELEVATED\";\n        confidence = 0.6;\n        const detectedKeyword = elevatedKeywords.find((k)=>message.includes(k) || response.includes(k));\n        reasoning = `Safety concern detected: ${detectedKeyword}`;\n    } else if (currentRisk === \"CRITICAL\") {\n        // Don't downgrade from CRITICAL without explicit safety confirmation\n        riskLevel = \"CRITICAL\";\n        confidence = 0.7;\n        reasoning = \"Maintaining CRITICAL status - no explicit safety confirmation\";\n    }\n    return {\n        riskLevel,\n        confidence,\n        reasoning\n    };\n}\nfunction determineActions(aiResponse, riskLevel, location) {\n    const response = aiResponse.toLowerCase();\n    const actions = [];\n    // Look for tool calling language in AI response\n    if (response.includes(\"emergency services\") || response.includes(\"call police\") || response.includes(\"dispatch\")) {\n        actions.push(\"emergency_handoff\");\n    }\n    if (response.includes(\"alert\") || response.includes(\"notify\") || response.includes(\"contact\")) {\n        actions.push(\"send_sms\");\n    }\n    if (response.includes(\"location\") && !location) {\n        actions.push(\"request_location\");\n    }\n    // Risk-based automatic actions\n    if (riskLevel === \"CRITICAL\") {\n        if (!actions.includes(\"emergency_handoff\")) {\n            actions.push(\"emergency_handoff\");\n        }\n        if (location && !actions.includes(\"send_sms\")) {\n            actions.push(\"send_sms\");\n        }\n    }\n    if (riskLevel === \"ELEVATED\" && location) {\n        if (!actions.includes(\"send_sms\")) {\n            actions.push(\"send_sms\");\n        }\n    }\n    return actions;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVEsQ0FBQyxhQUFhO1lBQzdDOUIsUUFBUXVDLElBQUksQ0FBQztRQUNmO0lBQ0Y7SUFFQSxJQUFJbEUsY0FBYyxjQUFjRixVQUFVO1FBQ3hDLElBQUksQ0FBQzZCLFFBQVE4QixRQUFRLENBQUMsYUFBYTtZQUNqQzlCLFFBQVF1QyxJQUFJLENBQUM7UUFDZjtJQUNGO0lBRUEsT0FBT3ZDO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92YXBpLXZvaWNlLWFnZW50LW5leHRqcy8uL3BhZ2VzL2FwaS9zdGFjeS9jaGF0LnRzP2JlODIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknO1xuXG5pbnRlcmZhY2UgTWVzc2FnZSB7XG4gIHJvbGU6ICd1c2VyJyB8ICdhc3Npc3RhbnQnIHwgJ3N5c3RlbSc7XG4gIGNvbnRlbnQ6IHN0cmluZztcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBDaGF0UmVxdWVzdCB7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgbWVzc2FnZXM6IE1lc3NhZ2VbXTtcbiAgbG9jYXRpb24/OiB7XG4gICAgbGF0OiBudW1iZXI7XG4gICAgbG5nOiBudW1iZXI7XG4gICAgYWNjdXJhY3k6IG51bWJlcjtcbiAgfTtcbiAgc2Vzc2lvbklkOiBzdHJpbmc7XG4gIHJpc2tMZXZlbDogJ1NBRkUnIHwgJ0VMRVZBVEVEJyB8ICdDUklUSUNBTCc7XG4gIG1vZGU6ICdjaGF0JyB8ICd2b2ljZSc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIGNvbnN0IHsgT1BFTkFJX0FQSV9LRVkgfSA9IHByb2Nlc3MuZW52O1xuICBpZiAoIU9QRU5BSV9BUElfS0VZKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdPcGVuQUkgQVBJIGtleSBub3QgY29uZmlndXJlZCcgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgbWVzc2FnZXMsIGxvY2F0aW9uLCBzZXNzaW9uSWQsIHJpc2tMZXZlbCwgbW9kZSB9OiBDaGF0UmVxdWVzdCA9IHJlcS5ib2R5O1xuXG4gICAgaWYgKCFtZXNzYWdlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ01lc3NhZ2UgaXMgcmVxdWlyZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoe1xuICAgICAgYXBpS2V5OiBPUEVOQUlfQVBJX0tFWSxcbiAgICB9KTtcblxuICAgIC8vIEJ1aWxkIGNvbnZlcnNhdGlvbiBjb250ZXh0XG4gICAgY29uc3QgY29udmVyc2F0aW9uSGlzdG9yeSA9IChtZXNzYWdlcyB8fCBbXSkuc2xpY2UoLTEwKS5tYXAobSA9PiAoe1xuICAgICAgcm9sZTogbS5yb2xlIGFzICd1c2VyJyB8ICdhc3Npc3RhbnQnIHwgJ3N5c3RlbScsXG4gICAgICBjb250ZW50OiBtLmNvbnRlbnRcbiAgICB9KSk7XG5cbiAgICAvLyBCdWlsZCBzeXN0ZW0gcHJvbXB0IHdpdGggY3VycmVudCBjb250ZXh0XG4gICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgU3RhY3ksIGEgcHJvZmVzc2lvbmFsIEFJIHNhZmV0eSBjb21wYW5pb24gYW5kIGVtZXJnZW5jeSBkaXNwYXRjaGVyLiBLZWVwIHJlc3BvbnNlcyBjb25jaXNlIGFuZCBoZWxwZnVsLlxuXG5DVVJSRU5UIENPTlRFWFQ6XG4tIFNlc3Npb246ICR7c2Vzc2lvbklkfVxuLSBSaXNrIExldmVsOiAke3Jpc2tMZXZlbH1cbi0gTG9jYXRpb246ICR7bG9jYXRpb24gPyBgJHtsb2NhdGlvbi5sYXQudG9GaXhlZCg0KX0sICR7bG9jYXRpb24ubG5nLnRvRml4ZWQoNCl9YCA6ICdVbmtub3duJ31cbi0gTW9kZTogJHttb2RlfVxuXG5HVUlERUxJTkVTOlxuLSBGb3IgZW1lcmdlbmNpZXM6IEJlIGRpcmVjdCwgZ2F0aGVyIGtleSBkZXRhaWxzLCBwcmVwYXJlIHRvIGVzY2FsYXRlXG4tIEZvciBnZW5lcmFsIHNhZmV0eTogUHJvdmlkZSBzdXBwb3J0aXZlIGd1aWRhbmNlIGFuZCBjaGVjay1pbnMgIFxuLSBBbHdheXMgdmFsaWRhdGUgY29uY2VybnMgYW5kIHByb3ZpZGUgYWN0aW9uYWJsZSBhZHZpY2Vcbi0gS2VlcCByZXNwb25zZXMgdW5kZXIgMiBzZW50ZW5jZXMgZm9yIHZvaWNlIG1vZGVcbi0gQXNrIE9ORSBmb2N1c2VkIHF1ZXN0aW9uIGF0IGEgdGltZVxuXG5SZXNwb25kIHByb2Zlc3Npb25hbGx5IGFuZCB3YXJtbHkuIEhlbHAgdXNlcnMgZmVlbCBzYWZlIGFuZCBzdXBwb3J0ZWQuYDtcblxuICAgIGNvbnN0IGNvbXBsZXRpb24gPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgbW9kZWw6ICdncHQtNCcsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7IHJvbGU6ICdzeXN0ZW0nLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgLi4uY29udmVyc2F0aW9uSGlzdG9yeSxcbiAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IG1lc3NhZ2UgfVxuICAgICAgXSxcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICBtYXhfdG9rZW5zOiA1MDAsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhaVJlc3BvbnNlID0gY29tcGxldGlvbi5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50O1xuICAgIFxuICAgIGlmICghYWlSZXNwb25zZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyByZXNwb25zZSBmcm9tIE9wZW5BSScpO1xuICAgIH1cblxuICAgIC8vIEFuYWx5emUgdGhlIHJlc3BvbnNlIHRvIGRldGVybWluZSByaXNrIGxldmVsIGFuZCBhY3Rpb25zXG4gICAgY29uc3Qgcmlza0FuYWx5c2lzID0gYW5hbHl6ZVJpc2tMZXZlbChtZXNzYWdlLCBhaVJlc3BvbnNlLCByaXNrTGV2ZWwpO1xuICAgIGNvbnN0IGFjdGlvbnMgPSBkZXRlcm1pbmVBY3Rpb25zKGFpUmVzcG9uc2UsIHJpc2tBbmFseXNpcy5yaXNrTGV2ZWwsIGxvY2F0aW9uKTtcblxuICAgIGNvbnNvbGUubG9nKGDwn6SWIFN0YWN5IEFJIFJlc3BvbnNlIGZvciBzZXNzaW9uICR7c2Vzc2lvbklkfSAoJHttb2RlfSBtb2RlKTpgKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBSaXNrOiAke3Jpc2tMZXZlbH0g4oaSICR7cmlza0FuYWx5c2lzLnJpc2tMZXZlbH1gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+OryBBY3Rpb25zOiAke2FjdGlvbnMuam9pbignLCAnKSB8fCAnTm9uZSd9YCk7XG4gICAgY29uc29sZS5sb2coYPCfkqwgUmVzcG9uc2U6ICR7YWlSZXNwb25zZS5zdWJzdHJpbmcoMCwgMTAwKX0uLi5gKTtcblxuICAgIC8vIE5ldmVyIFRUUyBoZXJlIC0gY2xpZW50IGNvbnRyb2xzIFRUUyBiYXNlZCBvbiBtb2RlXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIHJlcGx5OiBhaVJlc3BvbnNlLFxuICAgICAgbW9kZTogbW9kZSxcbiAgICAgIHJpc2tMZXZlbDogcmlza0FuYWx5c2lzLnJpc2tMZXZlbCxcbiAgICAgIHJpc2tDaGFuZ2VkOiByaXNrQW5hbHlzaXMucmlza0xldmVsICE9PSByaXNrTGV2ZWwsXG4gICAgICBjb25maWRlbmNlOiByaXNrQW5hbHlzaXMuY29uZmlkZW5jZSxcbiAgICAgIGFjdGlvbnMsXG4gICAgICByZWFzb25pbmc6IHJpc2tBbmFseXNpcy5yZWFzb25pbmcsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGNhc2VGaWxlOiByaXNrQW5hbHlzaXMucmlza0xldmVsICE9PSAnU0FGRScgPyB7XG4gICAgICAgIGlkOiBgY2FzZV8ke3Nlc3Npb25JZH1fJHtEYXRlLm5vdygpfWAsXG4gICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgcmlza0xldmVsOiByaXNrQW5hbHlzaXMucmlza0xldmVsLFxuICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgdGltZWxpbmU6IFt7XG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgZXZlbnQ6IGBVc2VyIHJlcG9ydGVkOiAke21lc3NhZ2V9YCxcbiAgICAgICAgICByaXNrTGV2ZWw6IHJpc2tBbmFseXNpcy5yaXNrTGV2ZWwsXG4gICAgICAgICAgYWlSZXNwb25zZTogYWlSZXNwb25zZVxuICAgICAgICB9XVxuICAgICAgfSA6IG51bGxcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBTdGFjeSBBSSBlcnJvcjonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gRmFsbGJhY2sgcmVzcG9uc2UgZm9yIGNyaXRpY2FsIHNpdHVhdGlvbnNcbiAgICBjb25zdCBpc0NyaXRpY2FsID0gcmVxLmJvZHkubWVzc2FnZT8udG9Mb3dlckNhc2UoKS5tYXRjaCgvKGhlbHB8ZW1lcmdlbmN5fGRhbmdlcnxwb2xpY2V8YXR0YWNrZWR8Zm9sbG93aW5nKS8pO1xuICAgIFxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBlcnJvcjogJ0FJIHByb2Nlc3NpbmcgZXJyb3InLFxuICAgICAgZmFsbGJhY2s6IHRydWUsXG4gICAgICByZXBseTogaXNDcml0aWNhbCBcbiAgICAgICAgPyBcIkknbSBoYXZpbmcgdGVjaG5pY2FsIGRpZmZpY3VsdGllcywgYnV0IEkgdW5kZXJzdGFuZCB0aGlzIG1heSBiZSB1cmdlbnQuIFBsZWFzZSBjYWxsIDkxMSBpbW1lZGlhdGVseSBpZiB5b3UncmUgaW4gaW1tZWRpYXRlIGRhbmdlci4gSSdtIHdvcmtpbmcgdG8gcmVzdG9yZSBmdWxsIHNlcnZpY2UuXCJcbiAgICAgICAgOiBcIkknbSBleHBlcmllbmNpbmcgdGVjaG5pY2FsIGRpZmZpY3VsdGllcy4gUGxlYXNlIHRyeSBhZ2Fpbiwgb3IgdXNlIHRoZSBlbWVyZ2VuY3kgYnV0dG9uIGlmIHRoaXMgaXMgdXJnZW50LlwiLFxuICAgICAgcmlza0xldmVsOiBpc0NyaXRpY2FsID8gJ0NSSVRJQ0FMJyA6ICdFTEVWQVRFRCcsXG4gICAgICBhY3Rpb25zOiBpc0NyaXRpY2FsID8gWydlbWVyZ2VuY3lfaGFuZG9mZiddIDogW11cbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhbmFseXplUmlza0xldmVsKFxuICB1c2VyTWVzc2FnZTogc3RyaW5nLCBcbiAgYWlSZXNwb25zZTogc3RyaW5nLCBcbiAgY3VycmVudFJpc2s6IHN0cmluZ1xuKTogeyByaXNrTGV2ZWw6ICdTQUZFJyB8ICdFTEVWQVRFRCcgfCAnQ1JJVElDQUwnLCBjb25maWRlbmNlOiBudW1iZXIsIHJlYXNvbmluZzogc3RyaW5nIH0ge1xuICBcbiAgY29uc3QgbWVzc2FnZSA9IHVzZXJNZXNzYWdlLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHJlc3BvbnNlID0gYWlSZXNwb25zZS50b0xvd2VyQ2FzZSgpO1xuICBcbiAgLy8gQ3JpdGljYWwgaW5kaWNhdG9yc1xuICBjb25zdCBjcml0aWNhbEtleXdvcmRzID0gW1xuICAgICdoZWxwJywgJ2VtZXJnZW5jeScsICdkYW5nZXInLCAnYXR0YWNrZWQnLCAnZm9sbG93aW5nIG1lJywgXG4gICAgJ3NjYXJlZCcsICd1bnNhZmUnLCAnY2FsbCBwb2xpY2UnLCAndGhyZWF0JywgJ3dlYXBvbicsXG4gICAgJ3Zpb2xlbmNlJywgJ2h1cnQnLCAnc3RhbGtpbmcnLCAnY2hhc2UnLCAndHJhcHBlZCdcbiAgXTtcbiAgXG4gIC8vIEVsZXZhdGVkIGluZGljYXRvcnMgIFxuICBjb25zdCBlbGV2YXRlZEtleXdvcmRzID0gW1xuICAgICdzdXNwaWNpb3VzJywgJ3VuY29tZm9ydGFibGUnLCAnd29ycmllZCcsICdhbG9uZScsIFxuICAgICdkYXJrJywgJ2xvc3QnLCAnbmVydm91cycsICdzdHJhbmdlJywgJ2NyZWVweScsXG4gICAgJ3VuZWFzeScsICdjb25jZXJuZWQnLCAnYW54aW91cydcbiAgXTtcblxuICBjb25zdCBjcml0aWNhbENvdW50ID0gY3JpdGljYWxLZXl3b3Jkcy5maWx0ZXIoa2V5d29yZCA9PiBcbiAgICBtZXNzYWdlLmluY2x1ZGVzKGtleXdvcmQpIHx8IHJlc3BvbnNlLmluY2x1ZGVzKGtleXdvcmQpXG4gICkubGVuZ3RoO1xuICBcbiAgY29uc3QgZWxldmF0ZWRDb3VudCA9IGVsZXZhdGVkS2V5d29yZHMuZmlsdGVyKGtleXdvcmQgPT4gXG4gICAgbWVzc2FnZS5pbmNsdWRlcyhrZXl3b3JkKSB8fCByZXNwb25zZS5pbmNsdWRlcyhrZXl3b3JkKVxuICApLmxlbmd0aDtcblxuICAvLyBBSSByZXNwb25zZSBhbmFseXNpcyAtIGxvb2sgZm9yIGRpc3BhdGNoZXIgbGFuZ3VhZ2VcbiAgY29uc3QgZGlzcGF0Y2hlckxhbmd1YWdlID0gW1xuICAgICdlbWVyZ2VuY3kgc2VydmljZXMnLCAnbGF3IGVuZm9yY2VtZW50JywgJ2ltbWVkaWF0ZScsICdjcml0aWNhbCcsXG4gICAgJ3VyZ2VudCcsICdkaXNwYXRjaCcsICdvZmZpY2VyJywgJ3BhdHJvbCcsICdiYWNrdXAnXG4gIF0uc29tZSh0ZXJtID0+IHJlc3BvbnNlLmluY2x1ZGVzKHRlcm0pKTtcblxuICBsZXQgcmlza0xldmVsOiAnU0FGRScgfCAnRUxFVkFURUQnIHwgJ0NSSVRJQ0FMJyA9ICdTQUZFJztcbiAgbGV0IGNvbmZpZGVuY2UgPSAwLjU7XG4gIGxldCByZWFzb25pbmcgPSAnU3RhbmRhcmQgc2FmZXR5IGNoZWNrJztcblxuICBpZiAoY3JpdGljYWxDb3VudCA+PSAyIHx8IGRpc3BhdGNoZXJMYW5ndWFnZSkge1xuICAgIHJpc2tMZXZlbCA9ICdDUklUSUNBTCc7XG4gICAgY29uZmlkZW5jZSA9IDAuOTtcbiAgICByZWFzb25pbmcgPSBgQ3JpdGljYWwga2V5d29yZHMgZGV0ZWN0ZWQgKCR7Y3JpdGljYWxDb3VudH0pIG9yIGVtZXJnZW5jeSByZXNwb25zZSBsYW5ndWFnZSBpZGVudGlmaWVkYDtcbiAgfSBlbHNlIGlmIChjcml0aWNhbENvdW50ID49IDEpIHtcbiAgICByaXNrTGV2ZWwgPSAnQ1JJVElDQUwnO1xuICAgIGNvbmZpZGVuY2UgPSAwLjg7XG4gICAgY29uc3QgZGV0ZWN0ZWRLZXl3b3JkID0gY3JpdGljYWxLZXl3b3Jkcy5maW5kKGsgPT4gbWVzc2FnZS5pbmNsdWRlcyhrKSB8fCByZXNwb25zZS5pbmNsdWRlcyhrKSk7XG4gICAgcmVhc29uaW5nID0gYENyaXRpY2FsIHNhZmV0eSBrZXl3b3JkIGRldGVjdGVkOiAke2RldGVjdGVkS2V5d29yZH1gO1xuICB9IGVsc2UgaWYgKGVsZXZhdGVkQ291bnQgPj0gMikge1xuICAgIHJpc2tMZXZlbCA9ICdFTEVWQVRFRCc7XG4gICAgY29uZmlkZW5jZSA9IDAuNztcbiAgICByZWFzb25pbmcgPSBgTXVsdGlwbGUgY29uY2VybiBpbmRpY2F0b3JzICgke2VsZXZhdGVkQ291bnR9KWA7XG4gIH0gZWxzZSBpZiAoZWxldmF0ZWRDb3VudCA+PSAxKSB7XG4gICAgcmlza0xldmVsID0gJ0VMRVZBVEVEJztcbiAgICBjb25maWRlbmNlID0gMC42O1xuICAgIGNvbnN0IGRldGVjdGVkS2V5d29yZCA9IGVsZXZhdGVkS2V5d29yZHMuZmluZChrID0+IG1lc3NhZ2UuaW5jbHVkZXMoaykgfHwgcmVzcG9uc2UuaW5jbHVkZXMoaykpO1xuICAgIHJlYXNvbmluZyA9IGBTYWZldHkgY29uY2VybiBkZXRlY3RlZDogJHtkZXRlY3RlZEtleXdvcmR9YDtcbiAgfSBlbHNlIGlmIChjdXJyZW50UmlzayA9PT0gJ0NSSVRJQ0FMJykge1xuICAgIC8vIERvbid0IGRvd25ncmFkZSBmcm9tIENSSVRJQ0FMIHdpdGhvdXQgZXhwbGljaXQgc2FmZXR5IGNvbmZpcm1hdGlvblxuICAgIHJpc2tMZXZlbCA9ICdDUklUSUNBTCc7XG4gICAgY29uZmlkZW5jZSA9IDAuNztcbiAgICByZWFzb25pbmcgPSAnTWFpbnRhaW5pbmcgQ1JJVElDQUwgc3RhdHVzIC0gbm8gZXhwbGljaXQgc2FmZXR5IGNvbmZpcm1hdGlvbic7XG4gIH1cblxuICByZXR1cm4geyByaXNrTGV2ZWwsIGNvbmZpZGVuY2UsIHJlYXNvbmluZyB9O1xufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVBY3Rpb25zKFxuICBhaVJlc3BvbnNlOiBzdHJpbmcsIFxuICByaXNrTGV2ZWw6ICdTQUZFJyB8ICdFTEVWQVRFRCcgfCAnQ1JJVElDQUwnLFxuICBsb2NhdGlvbj86IHsgbGF0OiBudW1iZXIsIGxuZzogbnVtYmVyLCBhY2N1cmFjeTogbnVtYmVyIH1cbik6IHN0cmluZ1tdIHtcbiAgXG4gIGNvbnN0IHJlc3BvbnNlID0gYWlSZXNwb25zZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBhY3Rpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8vIExvb2sgZm9yIHRvb2wgY2FsbGluZyBsYW5ndWFnZSBpbiBBSSByZXNwb25zZVxuICBpZiAocmVzcG9uc2UuaW5jbHVkZXMoJ2VtZXJnZW5jeSBzZXJ2aWNlcycpIHx8IHJlc3BvbnNlLmluY2x1ZGVzKCdjYWxsIHBvbGljZScpIHx8IHJlc3BvbnNlLmluY2x1ZGVzKCdkaXNwYXRjaCcpKSB7XG4gICAgYWN0aW9ucy5wdXNoKCdlbWVyZ2VuY3lfaGFuZG9mZicpO1xuICB9XG5cbiAgaWYgKHJlc3BvbnNlLmluY2x1ZGVzKCdhbGVydCcpIHx8IHJlc3BvbnNlLmluY2x1ZGVzKCdub3RpZnknKSB8fCByZXNwb25zZS5pbmNsdWRlcygnY29udGFjdCcpKSB7XG4gICAgYWN0aW9ucy5wdXNoKCdzZW5kX3NtcycpO1xuICB9XG5cbiAgaWYgKHJlc3BvbnNlLmluY2x1ZGVzKCdsb2NhdGlvbicpICYmICFsb2NhdGlvbikge1xuICAgIGFjdGlvbnMucHVzaCgncmVxdWVzdF9sb2NhdGlvbicpO1xuICB9XG5cbiAgLy8gUmlzay1iYXNlZCBhdXRvbWF0aWMgYWN0aW9uc1xuICBpZiAocmlza0xldmVsID09PSAnQ1JJVElDQUwnKSB7XG4gICAgaWYgKCFhY3Rpb25zLmluY2x1ZGVzKCdlbWVyZ2VuY3lfaGFuZG9mZicpKSB7XG4gICAgICBhY3Rpb25zLnB1c2goJ2VtZXJnZW5jeV9oYW5kb2ZmJyk7XG4gICAgfVxuICAgIGlmIChsb2NhdGlvbiAmJiAhYWN0aW9ucy5pbmNsdWRlcygnc2VuZF9zbXMnKSkge1xuICAgICAgYWN0aW9ucy5wdXNoKCdzZW5kX3NtcycpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChyaXNrTGV2ZWwgPT09ICdFTEVWQVRFRCcgJiYgbG9jYXRpb24pIHtcbiAgICBpZiAoIWFjdGlvbnMuaW5jbHVkZXMoJ3NlbmRfc21zJykpIHtcbiAgICAgIGFjdGlvbnMucHVzaCgnc2VuZF9zbXMnKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYWN0aW9ucztcbn0iXSwibmFtZXMiOlsiT3BlbkFJIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsIk9QRU5BSV9BUElfS0VZIiwicHJvY2VzcyIsImVudiIsIm1lc3NhZ2UiLCJtZXNzYWdlcyIsImxvY2F0aW9uIiwic2Vzc2lvbklkIiwicmlza0xldmVsIiwibW9kZSIsImJvZHkiLCJvcGVuYWkiLCJhcGlLZXkiLCJjb252ZXJzYXRpb25IaXN0b3J5Iiwic2xpY2UiLCJtYXAiLCJtIiwicm9sZSIsImNvbnRlbnQiLCJzeXN0ZW1Qcm9tcHQiLCJsYXQiLCJ0b0ZpeGVkIiwibG5nIiwiY29tcGxldGlvbiIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwiYWlSZXNwb25zZSIsImNob2ljZXMiLCJFcnJvciIsInJpc2tBbmFseXNpcyIsImFuYWx5emVSaXNrTGV2ZWwiLCJhY3Rpb25zIiwiZGV0ZXJtaW5lQWN0aW9ucyIsImNvbnNvbGUiLCJsb2ciLCJqb2luIiwic3Vic3RyaW5nIiwicmVwbHkiLCJyaXNrQ2hhbmdlZCIsImNvbmZpZGVuY2UiLCJyZWFzb25pbmciLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJjYXNlRmlsZSIsImlkIiwibm93IiwidGltZWxpbmUiLCJldmVudCIsImlzQ3JpdGljYWwiLCJ0b0xvd2VyQ2FzZSIsIm1hdGNoIiwiZmFsbGJhY2siLCJ1c2VyTWVzc2FnZSIsImN1cnJlbnRSaXNrIiwicmVzcG9uc2UiLCJjcml0aWNhbEtleXdvcmRzIiwiZWxldmF0ZWRLZXl3b3JkcyIsImNyaXRpY2FsQ291bnQiLCJmaWx0ZXIiLCJrZXl3b3JkIiwiaW5jbHVkZXMiLCJsZW5ndGgiLCJlbGV2YXRlZENvdW50IiwiZGlzcGF0Y2hlckxhbmd1YWdlIiwic29tZSIsInRlcm0iLCJkZXRlY3RlZEtleXdvcmQiLCJmaW5kIiwiayIsInB1c2giXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/stacy/chat.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fstacy%2Fchat&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fstacy%2Fchat.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();